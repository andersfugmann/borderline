BORDERLINE=../src/main

autogenerated = generic/protocols.bl generic/services.bl

generic/protocols.bl: /etc/protocols
	@egrep -v "^#" $< | while read name number rest; do \
                              if [ -n "$${name}" ]; then \
                                 echo "define $${name} = $${number}"; \
                              fi; \
                           done | uniq > $@

generic/services.bl: /etc/services
	@egrep -v "^#" $< | while read name number rest; do \
                              if [ -n "$${name}" ] && [ "$${number##*/}" = "tcp" -o "$${number##*/}" = "udp" ]; then \
                                 echo "define $${name} = $${number%%/*}"; \
                              fi; \
                           done | uniq > $@



main.bl: $(autogenerated)

main.out: main main.bl
	OCAMLRUNPARAM=b $(BORDERLINE) main.bl > $@

main.screen: main.out
	@cat main.out

.PHONY: main

main:
	$(MAKE) -C ../src main

clean:
	@find . -name \*~ | xargs $(RM)
	@$(RM) $(autogenerated)


